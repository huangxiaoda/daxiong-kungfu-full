<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§ç†Šå­¦æ­¦åŠŸï¼šåŠŸå¤«èŠ‚å¥æŒ‘æˆ˜</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- æ·»åŠ emojiå­—ä½“æ”¯æŒ -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&family=Apple+Color+Emoji&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.paddle.com/paddle/paddle.js"></script>
    <script>
    </script>
    <style>
        /* é¡µé¢æ•´ä½“æ ·å¼ */
        body {
             font-family: 'Zhi Mang Xing', cursive, 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
            background-color: #f7e0b5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            flex-direction: column;
        }

        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            width: 95%;
            max-width: 900px;
            height: 800px;
            background: linear-gradient(to bottom, #aed581, #dce775);
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            border: 8px solid #8bc34a;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .info-bar {
            background-color: #558b2f;
            color: #fff;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.6em;
            font-weight: bold;
            border-bottom: 4px solid #33691e;
            font-family: 'Press Start 2P', cursive;
        }

        .info-bar span {
            margin: 0 15px;
        }

        .info-bar .level {
            font-size: 0.8em;
            color: #cddc39;
        }

        #bgMusicToggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            transition: color 0.3s ease;
        }

        #bgMusicToggle:hover {
            color: #cddc39;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .play-area {
            flex-grow: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
        }

        /* å¸ˆå‚…å›¾æ ‡ */
        #master {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 7em;
            color: rgba(0, 0, 0, 0.7);
            user-select: none;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 5;
            line-height: 1;
        }

        /* å¸ˆå‚…çš„æ‹›å¼æç¤º */
        .master-move-display {
            position: absolute;
            top: 24%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 12px 18px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-size: 3.5em;
            color: #d84315;
            font-weight: bold;
            text-align: center;
            min-width: 140px;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 25;
            min-height: 55px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .master-move-display.show {
            opacity: 1;
            transform: translate(-50%, -50%);
        }

        .master-move-display .text {
            font-size: 0.4em;
            color: #333;
            margin-top: 5px;
        }

        /* å¤§ç†Šå›¾æ ‡ */
        #bear {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9em;
            color: #6d4c41;
            user-select: none;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 5;
            line-height: 1;
            display: block;
        }

        /* ç©å®¶æ“ä½œæŒ‰é’® */
        .player-controls {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 10;
            max-width: 250px;
        }

    .action-button {
    width: 100px;
    height: 100px;
    background-color: #ffb300;
    border: 3px solid #fb8c00;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 3em;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    user-select: none;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 5px;
}

/* ä¿®å¤ï¼šåŠ¨ä½œå›¾æ ‡å‚ç›´å±…ä¸­ */
.action-button span {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 40px;
    font-size: 1.2em;
    line-height: 0.8;
    font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
}

.action-button .text {
    margin-top: 8px;
    font-size: 0.9em;
    color: #333;
    text-align: center;
}

        /* æ¸¸æˆåé¦ˆæç¤º */
        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6em;
            font-weight: bold;
            color: #4CAF50;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.6);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 20;
            pointer-events: none;
            white-space: nowrap;
        }

        .feedback.show {
            opacity: 1;
            transform: translate(-50%, -70%);
        }

        .feedback.wrong {
            color: #F44336;
        }

        .feedback.combo {
            color: #FFEB3B;
            font-size: 7em;
            animation: pulse 0.5s ease-out forwards;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            50% { transform: translate(-50%, -60%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -70%) scale(1); opacity: 0; }
        }

        /* æ¸¸æˆç»“æŸæˆ–å¼€å§‹å‰çš„å åŠ å±‚ */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 30;
            flex-direction: column;
            color: white;
            font-size: 2.2em;
            text-align: center;
            border-radius: 25px;
        }

        .overlay h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .overlay p {
            font-size: 0.8em;
            margin-top: -10px;
            margin-bottom: 30px;
        }

        .overlay button {
            background-color: #ffb300;
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .overlay button:hover {
            background-color: #ffa000;
        }

        .overlay.hidden {
            display: none !important;
            opacity: 0;
            pointer-events: none;
        }

        /* æ”¾æ¾éŸ³ä¹æ’­æ”¾å™¨æ ·å¼ */
        .relax-music-player {
            width: calc(100% - 40px);
            background-color: #e0f2f7;
            padding: 15px 20px;
            border-radius: 15px;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #b2ebf2;
            z-index: 5;
        }

        .relax-music-player h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #00bcd4;
            font-size: 1.2em;
        }

        .relax-music-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }

        .relax-music-controls button {
            background-color: #4dd0e1;
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .relax-music-controls button:hover {
            background-color: #26c6da;
        }

        .relax-music-controls input[type="range"] {
            width: 100px;
            -webkit-appearance: none;
            height: 6px;
            background: #b2ebf2;
            border-radius: 3px;
            outline: none;
        }

        .relax-music-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #00bcd4;
            cursor: pointer;
        }

        .relax-music-controls label {
            font-size: 0.9em;
            color: #00838f;
        }

        /* éŸ³ä¹é€‰æ‹©å™¨å¸ƒå±€è°ƒæ•´ */
        .music-selector-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
            width: 100%;
        }

        .music-selector {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
            min-width: 180px;
            justify-content: center;
        }

        .music-selector label {
            font-size: 0.9em;
            color: #00838f;
            white-space: nowrap;
        }

        .music-selector select {
            padding: 5px 8px;
            border-radius: 8px;
            border: 1px solid #00bcd4;
            background-color: #e0f7fa;
            color: #00838f;
            font-size: 0.9em;
            cursor: pointer;
            flex-grow: 1;
            min-width: 80px;
            max-width: 180px;
          
            /* æ–°å¢ï¼šå›ºå®šé«˜åº¦ï¼Œå¯ç”¨æ»šåŠ¨ */
            height: 35px;
            max-height: 35px;
        }

        /* ğŸ¯ æ–°å¢åŠ¨æ€é«˜åº¦å±•å¼€æ ·å¼ */
        .music-selector select:focus {
            height: auto;
            max-height: 400px; /* å›ºå®šé«˜åº¦ */
            overflow-y: auto; /* å¯ç”¨æ»šåŠ¨ */
            position: absolute; /* æ”¹ä¸ºç»å¯¹å®šä½ */
            top: 100%; /* åœ¨é€‰æ‹©å™¨ä¸‹æ–¹å±•å¼€ */
            left: 0;
            width: 100%;
            z-index: 1000; /* æé«˜å±‚çº§ */
            background: #e0f7fa;
            border: 1px solid #00bcd4;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* é€‰é¡¹æ ·å¼ä¼˜åŒ– */
        .music-selector select option {
            padding: 8px 12px;
            font-size: 0.85em;
            background-color: #e0f7fa;
            border-bottom: 1px solid #b2ebf2;
        }

        .music-selector select option:checked {
            background-color: #00bcd4;
            color: white;
        }

        .music-selector select option:hover {
            background-color: #b2ebf2;
        }

        /* ===== è´­ä¹°åŠŸèƒ½æ ·å¼ ===== */
        .purchase-modal {
            background: linear-gradient(135deg, #ffd54f, #ffb300);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 5px solid #ff8f00;
            max-width: 400px;
            width: 90%;
            font-family: 'Press Start 2P', cursive;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .purchase-modal h2 {
            color: #d84315;
            margin-bottom: 15px;
            font-size: 1.5em;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .purchase-modal p {
            margin: 12px 0;
            font-size: 0.9em;
            line-height: 1.5;
            color: #5d4037;
        }

        #purchaseButton {
            background: linear-gradient(to bottom, #e65100, #bf360c);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            font-family: 'Press Start 2P', cursive;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.3);
            box-shadow: 0 4px 0 #7f0000;
        }

        #purchaseButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #7f0000;
        }

        #purchaseButton:active {
            transform: translateY(1px);
            box-shadow: 0 2px 0 #7f0000;
        }

        .price {
            font-weight: bold;
            color: #5d4037;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .remaining-tries {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 193, 7, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            color: #5d4037;
            z-index: 25;
            font-family: 'Press Start 2P', cursive;
         white-space: nowrap; /* æ·»åŠ è¿™è¡Œï¼Œé˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
/* ç¡®ä¿emojiæ­£ç¡®æ˜¾ç¤º */
.character, .action-button span, .master-move-display .emoji {
    font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'Zhi Mang Xing', cursive;
}

/* å¸ˆå‚…å’Œå¤§ç†Šçš„emojiæ ·å¼ */
#master, #bear {
    font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
}

/* å¸ˆå‚…æ‹›å¼æ˜¾ç¤ºçš„emoji */
.master-move-display .emoji {
    font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
}
/* éŸ³ä¹è¯´æ˜å¼¹å‡ºæ¡† */
.music-description-popup {
    position: fixed;
    top: 85%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #ffd54f, #ffb300);
    color: #5d4037;
    padding: 15px 25px;
    border-radius: 15px;
    font-size: 1.1em;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    max-width: 320px;
    text-align: center;
    border: 2px solid #ffb300;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    font-family: 'SimSun', 'å®‹ä½“', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-seri;
}       
.music-description-popup.show {
    opacity: 1;
}

.description-content {
    font-family: inherit;
    font-weight: bold;
}
        
/* ä¸‹é¢æ˜¯åŸæœ‰çš„ç§»åŠ¨ç«¯é€‚é…æ ·å¼ */
@media (max-width: 768px) {
    .music-description-popup {
        max-width: 280px;
        font-size: 1em;
        padding: 12px 20px;
        font-family: 'SimSun', 'å®‹ä½“', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-seri;
    }
    .description-content {
        font-family: inherit;
    }     
}        

        /* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .game-container {
        height: 780px;
        width: 98%;
        border-radius: 20px;
    }

    .info-bar {
        font-size: 1.2em;
        padding: 10px 15px;
    }

    #master {
        top: -22px;
        font-size: 5em;
    }

    .action-button {
        width: 70px;
        height: 70px;
        font-size: 2.2em;
    }
    
    .action-button span {
        height: 30px;
        font-size: 0.9em  !important;
    }
    
    .action-button .text {
        font-size: 0.7em;
    }

    .remaining-tries {
        top: 120px;
        white-space: nowrap;
    }

    #bear {
        bottom: 100px;
        font-size: 7em;
    }

    .master-move-display {
        top: 30%;
        font-size: 3em;
        padding: 8px 12px;
        min-height: 50px;
        min-width: 110px;   
    }
    
    .player-controls {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        padding: 15px;
        bottom: -5px;
        max-width: 200px;
    }

    .feedback {
        font-size: 4em;
    }

    .feedback.combo {
        font-size: 5em;
    }

    .overlay {
        font-size: 1.5em;
    }

    .overlay h2 {
        font-size: 1.2em;
    }

    .overlay p {
        font-size: 0.7em;
    }

    .overlay button {
        padding: 10px 20px;
        font-size: 1.2em;
    }

    .relax-music-player {
        padding: 10px 15px;
        margin-top: 15px;
    }

    .relax-music-player h3 {
        font-size: 1.1em;
    }

    .relax-music-controls {
        flex-direction: column;
        gap: 8px;
    }

    .relax-music-controls input[type="range"] {
        width: 80%;
    }

    .music-selector-row {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
        width: 100%;
    }

    .music-selector {
        width: 100%;
        justify-content: flex-start;
    }

    .music-selector select {
        width: 100%;
        height: 32px;
        max-height: 32px;
    }
    
    /* ğŸ¯ æ–°å¢ç§»åŠ¨ç«¯åŠ¨æ€é«˜åº¦ */
    @media (max-width: 768px) {
        .music-selector select:focus {
            height: auto;
            max-height: 300px; /* ç§»åŠ¨ç«¯ç¨çŸ® */
            overflow-y: auto; /* å¯ç”¨æ»šåŠ¨ */
            position: absolute; /* æ”¹ä¸ºç»å¯¹å®šä½ */
            top: 100%; /* åœ¨é€‰æ‹©å™¨ä¸‹æ–¹å±•å¼€ */
            left: 0;
            width: 100%;
            z-index: 1000; /* æé«˜å±‚çº§ */
            background: #e0f7fa;
            border: 1px solid #00bcd4;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    }
        
} /* è¿™é‡Œæ·»åŠ é—­åˆæ‹¬å· */
/* éŸ³ä¹æ§åˆ¶å¤´éƒ¨å¸ƒå±€ */
.music-control-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 10px;
}

.music-control-header h3 {
    margin: 0;
    color: #00bcd4;
    font-size: 1.2em;
}

/* é—¹é’Ÿåˆ‡æ¢æŒ‰é’® */
.alarm-toggle {
    background: none;
    border: none;
    font-size: 1.5em;
    cursor: pointer;
    padding: 5px 8px;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.alarm-toggle:hover {
    background-color: rgba(0, 188, 212, 0.1);
    transform: scale(1.1);
}

.alarm-toggle.active {
    background-color: #ffb300;
    color: white;
    animation: alarmPulse 2s infinite;
}

/* é—¹é’Ÿè„‰å†²åŠ¨ç”» */
@keyframes alarmPulse {
    0% {
        box-shadow: 0 0 0 0 rgba(255, 179, 0, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(255, 179, 0, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(255, 179, 0, 0);
    }
}

/* é—¹é’Ÿè®¾ç½®çŠ¶æ€ */
.alarm-toggle.set {
    background-color: #4caf50;
    animation: alarmPulseGreen 2s infinite;
}

@keyframes alarmPulseGreen {
    0% {
        box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
    }
}

/* é—¹é’Ÿè®¾ç½®é¢æ¿ */
.alarm-panel {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    padding: 15px;
    margin-top: 10px;
    border: 2px solid #ffb300;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
}

.alarm-panel h4 {
    margin: 0 0 10px 0;
    color: #5d4037;
    text-align: center;
}

.alarm-setting {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    gap: 8px;
}

.alarm-setting label {
    min-width: 50px;
    font-size: 0.9em;
    color: #00838f;
}

.alarm-setting input,
.alarm-setting select {
    flex: 1;
    padding: 5px 8px;
    border: 1px solid #00bcd4;
    border-radius: 5px;
    background: #e0f7fa;
    font-size: 0.9em;
}

.alarm-save {
    width: 100%;
    background: #4caf50;
    color: white;
    border: none;
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 5px;
    font-weight: bold;
}

.alarm-save:hover {
    background: #45a049;
}

.hidden {
    display: none !important;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
    .music-control-header h3 {
        font-size: 1.1em;
    }
    
    .alarm-toggle {
        font-size: 1.3em;
        padding: 4px 6px;
    }
    
    .alarm-panel {
        padding: 12px;
    }
}
    </style>
</head>
<body>
    <div class="game-container">
        <!-- æ¸¸æˆèƒŒæ™¯éŸ³ä¹ -->
        <audio id="game-bg-music" loop>
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ¸¸æˆèƒŒæ™¯éŸ³ä¹ã€‚
        </audio>

        <div class="info-bar">
            <span>æ—¶é—´: <span id="timer">60</span>s</span>
            <span>åˆ†æ•°: <span id="score">0</span></span>
            <span>è¿å‡»: <span id="combo">0</span></span>
            <span class="level">ç­‰çº§: <span id="level">å­¦å¾’</span></span>
            <button id="bgMusicToggle" title="åˆ‡æ¢èƒŒæ™¯éŸ³ä¹">
                <i class="fas fa-volume-up"></i>
            </button>
        </div>

        <div class="play-area">
            <!-- å¸ˆå‚…å›¾æ ‡ -->
            <div id="master" class="character">ğŸ‘¨â€ğŸ«</div>

            <!-- å¤§ç†Šå›¾æ ‡ -->
            <div id="bear" class="character">ğŸ»</div>

            <div id="masterMoveDisplay" class="master-move-display">
                <span class="emoji"></span>
                <div class="text"></div>
            </div>

            <div id="feedback" class="feedback"></div>

            <div class="player-controls">
                <button class="action-button" data-action="left-punch">
                    <span>ğŸ‘Š</span><div class="text">å·¦æ‹³</div>
                </button>
                <button class="action-button" data-action="right-punch">
                    <span>ğŸ¤œ</span><div class="text">å³æ‹³</div>
                </button>
                <button class="action-button" data-action="up-kick">
                    <span>ğŸ¤¸</span><div class="text">ä¸Šè¸¢</div>
                </button>
                <button class="action-button" data-action="down-block">
                    <span>ğŸ›¡ï¸</span><div class="text">ä¸‹æŒ¡</div>
                </button>
                <button class="action-button" data-action="jump">
                    <span>â¬†ï¸</span><div class="text">è·³è·ƒ</div>
                </button>
                <button class="action-button" data-action="crouch">
                    <span>â¤µï¸</span><div class="text">è¹²ä¼</div>
                </button>
            </div>
        </div>

        <div class="relax-music-player">
            <div class="music-selector-row">
                <div class="music-selector">
                    <label for="bgMusicSelector">æ¸¸æˆéŸ³ä¹:</label>
                    <select id="bgMusicSelector"></select>
                </div>
                <div class="music-selector">
                    <label for="relaxMusicSelector">æ”¾æ¾éŸ³ä¹:</label>
                    <select id="relaxMusicSelector"></select> 
                </div>
            </div>

            <div class="music-control-header">
                <h3>ğŸµ æ”¾æ¾éŸ³ä¹æ§åˆ¶ ğŸµ</h3>
                <button id="alarmToggle" class="alarm-toggle" title="è®¾ç½®é—¹é’Ÿ">â°</button>
            </div>

            <audio id="relax-audio" loop>
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ”¾æ¾éŸ³ä¹ã€‚
            </audio>

            <div class="relax-music-controls">
                <button id="relaxPlayButton">æ’­æ”¾</button>
                <button id="relaxPauseButton">æš‚åœ</button>
                <label for="relaxVolumeSlider">éŸ³é‡:</label>
                <input type="range" id="relaxVolumeSlider" min="0" max="1" step="0.05" value="0.5">
            </div>
            <!-- ğŸ¯ æ–°å¢çš„é—¹é’Ÿé¢æ¿ -->
            <div id="alarmPanel" class="alarm-panel hidden">
                <h4>â° é—¹é’Ÿè®¾ç½®</h4>
                <div class="alarm-setting">
                    <label>æ—¶é—´:</label>
                    <input type="time" id="alarmTime">
                </div>
                <div class="alarm-setting">
                    <label>é“ƒå£°:</label>
                    <select id="alarmSound">
                <option value="default">é»˜è®¤é“ƒå£°</option>
                <option value="music/æ™¨é—´å”¤èµ·_01_æŸ”å’Œé—¹é’Ÿ.mp3">æ™¨é—´å”¤èµ·_01_æŸ”å’Œé—¹é’Ÿ</option>
                <option value="music/æ™¨é—´å”¤èµ·_02_ç ´æ™“é¸Ÿé¸£.mp3">æ™¨é—´å”¤èµ·_02_ç ´æ™“é¸Ÿé¸£</option>
                    </select>
                </div>
                <div class="alarm-setting">
                    <label>é‡å¤:</label>
                    <select id="alarmRepeat">
                        <option value="once">ä»…ä¸€æ¬¡</option>
                        <option value="daily">æ¯å¤©</option>
                        <option value="weekdays">å·¥ä½œæ—¥</option>
                    </select>
                </div>
                <button id="saveAlarm" class="alarm-save">ä¿å­˜é—¹é’Ÿ</button>
            </div>
        </div>

        <!-- æ¸¸æˆå¼€å§‹å åŠ å±‚ -->
        <div class="overlay" id="gameOverlay">
            <h2>å¤§ç†Šå­¦æ­¦åŠŸï¼</h2>
            <p>çœ‹å¸ˆå‚…æ¼”ç¤ºï¼Œå¿«é€Ÿç‚¹å‡»å¯¹åº”çš„æ‹›å¼ï¼</p>
            <button id="startButton">å¼€å§‹ç»ƒåŠŸ</button>
        </div>

        <!-- è´­ä¹°åŠŸèƒ½å¼¹çª— -->
        <div id="purchaseOverlay" class="overlay hidden">
            <div class="purchase-modal">
                <h2>è¯•ç»ƒç»“æŸï¼</h2>
                <p>å°‘ä¾ å·²ä½“éªŒ5æ¬¡åŠŸå¤«è¯•ç»ƒ</p>
                <p>è´­ä¹°æ°¸ä¹…ç‰ˆï¼ŒæŒ‘æˆ˜èŠ‚å¥ååº”ï¼</p>
                <button id="purchaseButton">è´­ä¹°æ°¸ä¹…ç‰ˆ</button>
                <p class="price">ç•…äº«æ— é™å¿«ä¹</p>
            </div>
        </div>
    </div>

    <script>
        // ===== è´­ä¹°åŠŸèƒ½æ ¸å¿ƒé€»è¾‘ =====
        const UNLOCK_KEY = 'daxiong_pro_unlocked';
        const PLAY_COUNT_KEY = 'daxiong_play_count';

       // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
function checkGameStatus() {
    const isUnlocked = localStorage.getItem(UNLOCK_KEY) === 'true';
    
    if (isUnlocked) {
        hideRemainingTries();
        return true;
    } else {
        let playCount = parseInt(localStorage.getItem(PLAY_COUNT_KEY)) || 0;
        // åªåœ¨æ¸¸æˆå¼€å§‹æ—¶æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°ï¼Œä¸å¢åŠ æ¬¡æ•°
        showRemainingTries(5 - playCount);
        
        if (playCount < 5) {
            // æ³¨æ„ï¼šè¿™é‡Œä¸å†å¢åŠ æ¬¡æ•°ï¼Œæ¬¡æ•°åœ¨æ¸¸æˆç»“æŸæ—¶å¢åŠ 
            if (playCount >= 3) {
                showFeedback(`å‰©ä½™è¯•ç©æ¬¡æ•°: ${5 - playCount}`, 'combo');
            }
            return true;
        } else {
            showPurchaseOverlay();
            return false;
        }
    }
}

        // æ˜¾ç¤ºè´­ä¹°å¼¹çª—
        function showPurchaseOverlay() {
            const overlay = document.getElementById('purchaseOverlay');
            overlay.classList.remove('hidden');
            isGameRunning = false;
        }

        // éšè—è´­ä¹°å¼¹çª—
        function hidePurchaseOverlay() {
            const overlay = document.getElementById('purchaseOverlay');
            overlay.classList.add('hidden');
        }

        // æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°
        function showRemainingTries(count) {
            let remainingElement = document.getElementById('remainingTries');
            if (!remainingElement) {
                remainingElement = document.createElement('div');
                remainingElement.id = 'remainingTries';
                remainingElement.className = 'remaining-tries';
                document.querySelector('.play-area').appendChild(remainingElement);
            }
            remainingElement.textContent = `å‰©ä½™è¯•ç©: ${count}æ¬¡`;
            remainingElement.style.display = 'block';
        }

        // éšè—å‰©ä½™æ¬¡æ•°
        function hideRemainingTries() {
            const remainingElement = document.getElementById('remainingTries');
            if (remainingElement) {
                remainingElement.style.display = 'none';
            }
        }

        // å¤„ç†è´­ä¹°æˆåŠŸ
        function handlePurchaseSuccess() {
            localStorage.setItem(UNLOCK_KEY, 'true');
            hidePurchaseOverlay();
            hideRemainingTries();
            isGameRunning = true;
            showFeedback('å·²è´­ä¹°æ°¸ä¹…ç‰ˆ!','combo');
            startNewMoveSequence();
        }

        // åˆå§‹åŒ–è´­ä¹°æµç¨‹
        async function initiatePurchase() {
            // çœŸå®çš„è´­ä¹°æµç¨‹ - å‘å¸ƒæ—¶ä¸ºçœŸå®IAP
            if (confirm('ç¡®å®šè¦è´­ä¹°æ°¸ä¹…ç‰ˆæ¸¸æˆå—ï¼Ÿ')) {
                handlePurchaseSuccess();
            }
        }

        // ===== å…ƒç´ è·å– =====
        const timerElement = document.getElementById('timer');
        const scoreElement = document.getElementById('score');
        const comboElement = document.getElementById('combo');
        const levelElement = document.getElementById('level');
        const masterMoveDisplay = document.getElementById('masterMoveDisplay');
        const masterMoveEmoji = masterMoveDisplay.querySelector('.emoji');
        const masterMoveText = masterMoveDisplay.querySelector('.text');
        const actionButtons = document.querySelectorAll('.action-button');
        const feedbackDisplay = document.getElementById('feedback');
        const gameOverlay = document.getElementById('gameOverlay');
        const startButton = document.getElementById('startButton');

        // æ¸¸æˆéŸ³ä¹å…ƒç´ 
        const gameBgMusic = document.getElementById('game-bg-music');
        const bgMusicToggle = document.getElementById('bgMusicToggle');
        const bgMusicIcon = bgMusicToggle.querySelector('i');
        const bgMusicSelector = document.getElementById('bgMusicSelector');
        gameBgMusic.volume = 0.3;
        let isGameBgMusicPlaying = false;

        // æ”¾æ¾éŸ³ä¹å…ƒç´ 
        const relaxAudio = document.getElementById('relax-audio');
        const relaxPlayButton = document.getElementById('relaxPlayButton');
        const relaxPauseButton = document.getElementById('relaxPauseButton');
        const relaxVolumeSlider = document.getElementById('relaxVolumeSlider');
        const relaxMusicSelector = document.getElementById('relaxMusicSelector');
        relaxAudio.volume = relaxVolumeSlider.value;

        // ===== æ¸¸æˆçŠ¶æ€å˜é‡ =====
        let score = 0;
        let combo = 0;
        let timeLeft = 60;
        let gameInterval;
        let moveInterval;
        let isGameRunning = false;
        let expectedMoveId = null;
        let moveTimeout = null;
        let level = 1;

        // ===== å¸ƒå±€è°ƒæ•´å‡½æ•° =====
function updateLayoutForLevel(levelName) {
  const remainingElement = document.getElementById('remainingTries');
  const masterMoveDisplay = document.getElementById('masterMoveDisplay');
  const isMobile = window.innerWidth <= 768;

  // ç§»åŠ¨ç«¯ï¼šå®Œå…¨å›ºå®šï¼Œä¸éšç­‰çº§å˜åŒ–
  if (isMobile) {
    if (remainingElement) {
      remainingElement.style.top = '150px';
    }
    if (masterMoveDisplay) {
      masterMoveDisplay.style.top = '20%';
    }
  } else {
    // ç”µè„‘ç«¯ï¼šä¿æŒåŸæ¥çš„è°ƒæ•´é€»è¾‘
    if (levelName === 'å°ç†Šæ­¦è€…' || levelName === 'åŠŸå¤«å¤§ç†Š' || 
        levelName === 'å®—å¸ˆä¹‹å¾’' || levelName === 'ç†Šéœ¸å¤©ä¸‹') {
      if (remainingElement) {
        remainingElement.style.top = '160px';
      }
      if (masterMoveDisplay) {
        masterMoveDisplay.style.top = '28%';
      }
    } else {
      // çŸ­æ–‡å­—ç­‰çº§æ—¶æ¢å¤åŸä½ç½®
      if (remainingElement) {
        remainingElement.style.top = '140px';
      }
      if (masterMoveDisplay) {
        masterMoveDisplay.style.top = '27%';
      }
    }
  }
} 
    // ===== æ¸¸æˆæ•°æ® =====
        const moves = [
            { id: 'left-punch', emoji: 'ğŸ‘Š', text: 'å·¦æ‹³' },
            { id: 'right-punch', emoji: 'ğŸ¤œ', text: 'å³æ‹³' },
            { id: 'up-kick', emoji: 'ğŸ¤¸', text: 'ä¸Šè¸¢' },
            { id: 'down-block', emoji: 'ğŸ›¡ï¸', text: 'ä¸‹æŒ¡' },
            { id: 'jump', emoji: 'â¬†ï¸', text: 'è·³è·ƒ' },
            { id: 'crouch', emoji: 'â¤µï¸', text: 'è¹²ä¼' }
        ];

        const levels = [
            { scoreThreshold: 0, name: 'å­¦å¾’', moveSpeed: 1500 },
            { scoreThreshold: 100, name: 'å°ç†Šæ­¦è€…', moveSpeed: 1200 },
            { scoreThreshold: 300, name: 'åŠŸå¤«å¤§ç†Š', moveSpeed: 1000 },
            { scoreThreshold: 600, name: 'å®—å¸ˆä¹‹å¾’', moveSpeed: 800 },
            { scoreThreshold: 1000, name: 'ç†Šéœ¸å¤©ä¸‹', moveSpeed: 600 }
        ];

        // éŸ³ä¹åˆ—è¡¨
        const gameMusicList = [
            { name: "åŠŸå¤«èŠ‚å¥", src: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3" },
            { name: "å¥‹è¿›ä¹‹å‡»", src: "music/å¥‹è¿›ä¹‹å‡».mp3" },
            { name: "å±±æ—ä¿®ç‚¼", src: "music/å±±æ—ä¿®ç‚¼.mp3" }
        ];

        const relaxMusicList = [
            { name: "å¿«é€Ÿå…¥ç¡_01_æš–å‘¼å¸", src: "music/å¿«é€Ÿå…¥ç¡_01_æš–å‘¼å¸.mp3",description:"è¯´æ˜:æ¸©æš–çš„åˆæˆå™¨å«,ç¼“æ…¢å‘¼å¸èŠ‚å¥ï¼Œèƒ½å¼•å¯¼è¿›å…¥ç¡çœ "},
            { name: "å¿«é€Ÿå…¥ç¡_02_æµ·æµªæŸ”æƒ…", src: "music/å¿«é€Ÿå…¥ç¡_02_æµ·æµªæŸ”æƒ….mp3",description:"è¯´æ˜:è½»æŸ”çš„æµ·æµªå†²ä¸Šå²¸,å¹³é™è€Œæ— ç¼çš„å¾ªç¯,èƒŒæ™¯æ˜¯è½»æŸ”çš„å¾®é£,ç¯å¢ƒ,æ²¡æœ‰æ—‹å¾‹,éå¸¸é€‚åˆè¿›å…¥ç¡çœ " },
            { name: "å¿«é€Ÿå…¥ç¡_03_æ£•è‰²å™ªéŸ³", src: "music/å¿«é€Ÿå…¥ç¡_03_æ£•è‰²å™ªéŸ³.mp3",description:"è¯´æ˜:æ·±æ£•è‰²å™ªéŸ³,ç¼“æ…¢çš„è„‰åŠ¨æ³¢,èˆ’ç¼“,é•‡é™,ç¡çœ è¯±å¯¼"},
            { name: "å¿«é€Ÿå…¥ç¡_04_å¤œé›¨", src: "music/å¿«é€Ÿå…¥ç¡_04_å¤œé›¨.mp3",description:"è¯´æ˜:å±‹é¡¶æŒç»­å°é›¨ï¼Œæ— é›·å£°ï¼Œèˆ’é€‚ï¼Œè¯±å¯¼ç¡çœ "},
            { name: "å¿«é€Ÿå…¥ç¡_05_æ—ä¸­é¸Ÿè¯­", src: "music/å¿«é€Ÿå…¥ç¡_05_æ—ä¸­é¸Ÿè¯­.mp3",description:"è¯´æ˜:ä¸€æ®µå®é™æ£®æ—çš„èˆ’ç¼“éŸ³æ™¯,è¿œå¤„é¸Ÿé¸£å’Œè½»å¾®æºªæµ,å†¥æƒ³èˆ¬ã€æ°›å›´æ„Ÿåè¶³"},
            { name: "å¿«é€Ÿå…¥ç¡_06_é¸Ÿå„¿å½’å·¢", src: "music/å¿«é€Ÿå…¥ç¡_06_é¸Ÿå„¿å½’å·¢.mp3",description:"è¯´æ˜:è¿œå¤„æ£®æ—é£ä¼´çŒ«å¤´é¹°å«å£°ï¼Œé»‘æš—è€Œå¹³é™,æ— ç¼å¾ªç¯ï¼ŒåŠ©çœ "},
            { name: "å¿«é€Ÿå…¥ç¡_07_å¹³ç¼“ç€‘å¸ƒ", src: "music/å¿«é€Ÿå…¥ç¡_07_å¹³ç¼“ç€‘å¸ƒ.mp3",description:"è¯´æ˜:æ¸©æŸ”çš„ç€‘å¸ƒï¼ŒæŒç»­æµåŠ¨ï¼Œåº•ä¸‹æœ‰ç¯å¢ƒå«ï¼Œå‚¬çœ èˆ¬æ— ç¼å¾ªç¯"},
            { name: "æ·±ç¡æå‡_01_æ·±æµ·é²¸éŸ³", src: "music/æ·±ç¡æå‡_01_æ·±æµ·é²¸éŸ³.mp3",description:"è¯´æ˜:æ·±æµ·æ…¢éŸµ,æ­é…é¥è¿œçš„é²¸é¸£å’Œè¶…ä½é¢‘å£°æ³¢ï¼Œå¸¦æ¥æ·±æ²‰ã€èˆ’ç¼“çš„å¬è§‰æ„Ÿå—,å¸®åŠ©è¿›å…¥æ·±åº¦ç¡çœ çŠ¶æ€" },
            { name: "æ·±ç¡æå‡_02_ç²‰å™ªå¾·å°”å¡”æ³¢", src: "music/æ·±ç¡æå‡_02_ç²‰å™ªå¾·å°”å¡”æ³¢.mp3",description:"è¯´æ˜ï¼š40èµ«å…¹åŒè€³èŠ‚æ‹,ç²‰å™ªå†å åŠ å¾·å°”å¡”æ³¢å¢å¼º,å¸®åŠ©å¤§è„‘å¿«é€Ÿè¿›å…¥æ·±åº¦æ”¾æ¾æˆ–ç¡çœ çŠ¶æ€" },
            { name: "æµ…ç¡æ”¹å–„_01_å¤å¤œèŸ‹èŸ€", src: "music/æµ…ç¡æ”¹å–„_01_å¤å¤œèŸ‹èŸ€.mp3",description:"è¯´æ˜:èŸ‹èŸ€çš„å«å£°å…·æœ‰é‡å¤ã€ç¨³å®šçš„èŠ‚å¥å’Œé¢‘ç‡èŒƒå›´,å±äºå¤©ç„¶çš„ç™½å™ªéŸ³,èƒ½å¤Ÿè°ƒèŠ‚å‘¼å¸å’Œå¿ƒè·³,è§¦å‘æ”¾æ¾ååº”,å½±å“ç¥ç»ç³»ç»Ÿ,ä»è€Œæœ‰åˆ©äºæµ…ç¡çœ çš„ç»´æŒ" },
            { name: "æµ…ç¡æ”¹å–„_02_æºªæµè›™é¸£", src: "music/æµ…ç¡æ”¹å–„_02_æºªæµè›™é¸£.mp3",description:"è¯´æ˜:æ°´æµçš„æŒç»­è½»æŸ”æ„Ÿï¼Œç¨³å®šçš„ä½é¢‘å£°æ³¢ï¼Œä¼´é›¶æ˜Ÿè›™é¸£ï¼Œè½»èŠ‚å¥äº¤æ›¿ï¼Œå¸®åŠ©å¤§è„‘ä¿æŒæ”¾æ¾ï¼Œå¯¹æµ…ç¡çœ çš„æ”¯æŒæœ‰ç§¯æä½œç”¨" },
            { name: "æ™¨é—´å”¤èµ·_01_æŸ”å’Œé—¹é’Ÿ", src: "music/æ™¨é—´å”¤èµ·_01_æŸ”å’Œé—¹é’Ÿ.mp3",description:"è¯´æ˜:æ¸è¿›å¼é—¹é’Ÿ,ä¸ç–¾ä¸å¾,å‘Šåˆ«åˆºè€³çš„éª¤ç„¶é“ƒå£°,é“ƒå£°ä»å¾®å¼±è½»æŸ”å¼€å§‹,å¾ªåºæ¸è¿›ã€èŠ‚å¥èˆ’ç¼“æœ‰åº,ç»™ç¡çœ è¶³å¤Ÿçš„è¿‡æ¸¡ç©ºé—´,å¼€å¯å…ƒæ°”æ»¡æ»¡çš„ä¸€å¤©" },
            { name: "æ™¨é—´å”¤èµ·_02_ç ´æ™“é¸Ÿé¸£", src: "music/æ™¨é—´å”¤èµ·_02_ç ´æ™“é¸Ÿé¸£.mp3",description:"è¯´æ˜:ç ´æ™“é¸Ÿé¸£,ç¾¤é¸Ÿè‹é†’,æ¸å¼ºéŸµå¾‹,è½»æŸ”å”¤é†’,ç¾¤é¸Ÿç”¨å•¼é¸£åˆ’ç ´é™è°§,å£°éŸ³å¼ºåº¦å¾ªåºæ¸è¿›ã€èŠ‚å¥æŸ”å’Œæœ‰åº,è®©ç¡çœ çŠ¶æ€å¹³ç¨³è¿‡æ¸¡åˆ°æ¸…é†’" },
            { name: "å‡å‹æ”¾æ¾_01_å±±æºªæµæ°´", src: "music/å‡å‹æ”¾æ¾_01_å±±æºªæµæ°´.mp3",description:"è¯´æ˜:æ½ºæ½ºæµæ·Œçš„æ°´å£°,å®å’šä½œå“çš„æ³‰æ°´,èŠ‚å¥èˆ’ç¼“è€Œå¹³ç¨³,èƒ½æœ‰æ•ˆé©±æ•£ç„¦è™‘çš„é˜´éœ¾,ç´§ç»·çš„ç¥ç»æ…¢æ…¢æ¾å¼›,èˆ’ç¼“å‡å‹çš„æ•ˆæœ" },
            { name: "å‡å‹æ”¾æ¾_02_è—é’µç–—æ„ˆ", src: "music/å‡å‹æ”¾æ¾_02_è—é’µç–—æ„ˆ.mp3",description:"è¯´æ˜:è—å¼é¢‚é’µè½»æ•²æ…¢é¸£,é†‡åšå…±æŒ¯ç©¿é€èº«å¿ƒ,åƒæ¸©æŸ”çš„å£°æ³¢æŒ‰æ‘©.ä½é¢‘æŒ¯åŠ¨é¡ºç€ç©ºæ°”è”“å»¶,ä»å¬è§‰æ¸—å…¥è‚Œç†,æŠšå¹³ç´§ç»·çš„ç¥ç»ä¸ç„¦è™‘æƒ…ç»ª,èµ·åˆ°å‡å‹èˆ’ç¼“çš„ä½œç”¨" },
            { name: "å‚¬çœ ä¹ç« ", src: "music/å‚¬çœ ä¹ç« .mp3" },
            { name: "å¤§è‡ªç„¶åå¥æ›²", src: "music/å¤§è‡ªç„¶åå¥æ›².mp3" },
            { name: "æ£®æ—å†¥æƒ³æ›²", src: "music/æ£®æ—å†¥æƒ³æ›².mp3" },
            { name: "æ£®æ—æ‘‡ç¯®æ›²", src: "music/æ£®æ—æ‘‡ç¯®æ›².mp3" },
            { name: "é›¨æ—å†¥æƒ³", src: "music/é›¨æ—å†¥æƒ³.mp3" },
            { name: "æµ·æµªå£°", src: "https://www.bensound.com/bensound-music/bensound-relaxing.mp3" }
        ];

        // ===== éŸ³ä¹æ’­æ”¾è¾…åŠ©å‡½æ•° =====
        async function loadAndPlayMusic(audioElement, src, shouldPlay) {
            console.log(`å°è¯•åŠ è½½: ${src}, é¢„æœŸæ’­æ”¾: ${shouldPlay}`);
            audioElement.src = src;
            audioElement.load();
            if (shouldPlay) {
                try {
                    await new Promise((resolve, reject) => {
                        const onCanPlayThrough = () => {
                            console.log(`Audio canplaythrough: ${src}`);
                            audioElement.removeEventListener('canplaythrough', onCanPlayThrough);
                            audioElement.removeEventListener('loadeddata', onLoadedData);
                            audioElement.removeEventListener('error', onError);
                            resolve();
                        };
                        const onLoadedData = () => {
                            console.log(`Audio loadeddata: ${src}`);
                            audioElement.removeEventListener('canplaythrough', onCanPlayThrough);
                            audioElement.removeEventListener('loadeddata', onLoadedData);
                            audioElement.removeEventListener('error', onError);
                            resolve();
                        };
                        const onError = (e) => {
                            console.error(`Audio error during load/play: ${src}`, e);
                            audioElement.removeEventListener('canplaythrough', onCanPlayThrough);
                            audioElement.removeEventListener('loadeddata', onLoadedData);
                            audioElement.removeEventListener('error', onError);
                            reject(new Error(`Audio load error for ${src}: ${e.message || e.type}`));
                        };
                        audioElement.addEventListener('canplaythrough', onCanPlayThrough);
                        audioElement.addEventListener('loadeddata', onLoadedData);
                        audioElement.addEventListener('error', onError);
                        if (audioElement.readyState >= 4) {
                            onCanPlayThrough();
                        } else if (audioElement.readyState >= 2) {
                            onLoadedData();
                        }
                        setTimeout(() => {
                            reject(new Error(`Audio load timeout for ${src}`));
                        }, 7000);
                    });
                    await audioElement.play();
                    return true;
                } catch (e) {
                    console.warn(`éŸ³ä¹æ’­æ”¾å¤±è´¥ (URL: ${src})ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’æˆ–é“¾æ¥å¤±æ•ˆ/æ ¼å¼é”™è¯¯:`, e);
                    return false;
                }
            }
            return false;
        }

        // å¡«å……éŸ³ä¹é€‰æ‹©å™¨ä¸‹æ‹‰èœå•
        function populateMusicSelectors() {
            bgMusicSelector.innerHTML = '';
            relaxMusicSelector.innerHTML = '';

            gameMusicList.forEach((music) => {
                const option = document.createElement('option');
                option.value = music.src;
                option.textContent = music.name;
                bgMusicSelector.appendChild(option);
            });

            if (gameMusicList.length > 0) {
                gameBgMusic.src = gameMusicList[0].src;
                gameBgMusic.load();
            }

            relaxMusicList.forEach((music) => {
                const option = document.createElement('option');
                option.value = music.src;
                option.textContent = music.name;
                relaxMusicSelector.appendChild(option);
            });

            if (relaxMusicList.length > 0) {
                relaxAudio.src = relaxMusicList[0].src;
                relaxAudio.load();
            }
        }

        // ===== æ¸¸æˆæ ¸å¿ƒé€»è¾‘ =====
        // é‡ç½®æ¸¸æˆçŠ¶æ€
        function resetGame() {
            score = 0;
            combo = 0;
            timeLeft = 60;
            level = 1;
            scoreElement.textContent = score;
            comboElement.textContent = combo;
            timerElement.textContent = timeLeft;
            levelElement.textContent = levels[0].name;

            // ç¡®ä¿åœ¨é‡ç½®æ—¶æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            if (moveInterval) {
                clearInterval(moveInterval);
                moveInterval = null;
            }
            if (moveTimeout) {
                clearTimeout(moveTimeout);
                moveTimeout = null;
            }

            isGameRunning = false;
            expectedMoveId = null;
            masterMoveDisplay.classList.remove('show');
            feedbackDisplay.classList.remove('show', 'correct', 'wrong', 'combo');
            feedbackDisplay.textContent = '';
            enableActionButtons(true);
            gameBgMusic.pause();
            gameBgMusic.currentTime = 0;
            isGameBgMusicPlaying = false;
            bgMusicIcon.classList.remove('fa-volume-mute');
            bgMusicIcon.classList.add('fa-volume-up');

            relaxAudio.pause();
            relaxAudio.currentTime = 0; 
        }

        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
             console.log("startGame called.");
           
            // æ·»åŠ çš„æ¸¸æˆçŠ¶æ€æ£€æŸ¥
            if (!checkGameStatus()) {
                return;
            }

            // å¦‚æœæ¸¸æˆå·²ç»åœ¨è¿è¡Œï¼Œæˆ–è€…æ­£åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œåˆ™å¿½ç•¥é‡å¤è°ƒç”¨
            if (isGameRunning) {
                console.log("Game is already running or starting, ignoring duplicate call.");
                return;
            }

            resetGame();

            // å…³é”®ï¼šåœ¨è®¾ç½®isGameRunning=trueä¹‹å‰å…ˆéšè—overlayï¼Œé˜²æ­¢ç«äº‰æ¡ä»¶
            gameOverlay.classList.add('hidden');

            // å¢åŠ ä¸€ä¸ªçŸ­å»¶è¿Ÿï¼Œç¡®ä¿æµè§ˆå™¨æœ‰è¶³å¤Ÿæ—¶é—´å¤„ç† DOM æ›´æ–°å’Œæ¸²æŸ“
            await new Promise(resolve => setTimeout(resolve, 100));

            isGameRunning = true;
            try {
                gameInterval = setInterval(updateTimer, 1000);      
            } catch (error) {
                console.error("Failed to set gameInterval:", error);
                isGameRunning = false;
                gameOverlay.classList.remove('hidden');
                return;
            }

            startNewMoveSequence();

            // éŸ³ä¹æ’­æ”¾é€»è¾‘
            if (isGameBgMusicPlaying) {
                await loadAndPlayMusic(gameBgMusic, bgMusicSelector.value, true);
            }

            relaxAudio.pause();
            console.log("startGame finished. Game is running.");
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            // åªæœ‰å½“æ¸¸æˆæ­£åœ¨è¿è¡Œæ—¶æ‰æ›´æ–°æ—¶é—´
            if (!isGameRunning) {
                if (gameInterval) {
                    clearInterval(gameInterval);
                    gameInterval = null;
                }
                console.log("updateTimer called but game is not running.");
                return;
            }

            timeLeft--;
            timerElement.textContent = timeLeft;

            if (timeLeft <= 0) {
                endGame();
            }
        }

        // å¼€å§‹æ–°çš„æ‹›å¼åºåˆ—
        function startNewMoveSequence() {
            if (moveInterval) clearInterval(moveInterval);
            let currentLevelData = levels[0];
            for (let i = levels.length - 1; i >= 0; i--) {
                if (score >= levels[i].scoreThreshold) {
                    currentLevelData = levels[i];
                    level = i + 1;
                    break;
                }
            }
            levelElement.textContent = currentLevelData.name;
            moveInterval = setInterval(showNextMove, currentLevelData.moveSpeed);
            showNextMove();
        }

        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªæ‹›å¼
        function showNextMove() {
            if (!isGameRunning) return;
            clearTimeout(moveTimeout);
            if (expectedMoveId !== null) {
                handleWrongGuess(null);
            }
            masterMoveDisplay.classList.remove('show');
            const randomIndex = Math.floor(Math.random() * moves.length);
            const nextMove = moves[randomIndex];
            masterMoveEmoji.textContent = nextMove.emoji;
            masterMoveText.textContent = nextMove.text;
            masterMoveDisplay.classList.add('show');
            expectedMoveId = nextMove.id;
            actionButtons.forEach(button => {
                button.disabled = false;
                button.classList.remove('correct', 'wrong');
            });
            const currentLevelData = levels.find(l => score >= l.scoreThreshold) || levels[levels.length - 1];
            moveTimeout = setTimeout(() => {
                if (expectedMoveId !== null && isGameRunning) {
                    handleWrongGuess(null);
                }
            }, Math.max(currentLevelData.moveSpeed - 200, 300)); // ç¡®ä¿è‡³å°‘æœ‰300msååº”æ—¶é—´
        }

        // å¤„ç†ç©å®¶åŠ¨ä½œ
        function handlePlayerAction(event) {
            if (!isGameRunning || expectedMoveId === null) {
                console.log("Action ignored: Not running or no expected move.");
                return;
            }
            clearTimeout(moveTimeout);
            const clickedAction = event.currentTarget.dataset.action;
            const isCorrect = (clickedAction === expectedMoveId);
            expectedMoveId = null;
            masterMoveDisplay.classList.remove('show');
            enableActionButtons(false);
            if (isCorrect) {
                console.log("Correct!");
                score += (10 + combo * 2);
                combo++;
                scoreElement.textContent = score;
                comboElement.textContent = combo;
                if (combo > 1) {
                    showFeedback(`è¿å‡» x${combo}!`, 'combo');
                } else {
                    showFeedback('æ­£ç¡®ï¼', 'correct');
                }
                const nextLevelThreshold = levels[level] ? levels[level].scoreThreshold : Infinity;
                if (score >= nextLevelThreshold) {
                    level++;
                    levelElement.textContent = levels[level-1].name;
                    // åœ¨ç­‰çº§æå‡çš„ä»£ç ä¸­æ·»åŠ 
                    updateLayoutForLevel(levels[level-1].name);
                    startNewMoveSequence();
                    showFeedback(`ç­‰çº§æå‡ï¼`, 'combo');
                }
            } else {
                console.log("Wrong!");
                handleWrongGuess(event.currentTarget);
            }
        }

        // å¤„ç†é”™è¯¯çŒœæµ‹
        function handleWrongGuess(clickedButton) {
            score = Math.max(0, score - 5);
            combo = 0;
            scoreElement.textContent = score;
            comboElement.textContent = combo;
            showFeedback('é”™è¯¯ï¼', 'wrong');
            if (clickedButton) {
                clickedButton.classList.add('wrong');
            }
            expectedMoveId = null;
        }

        // æ˜¾ç¤ºåé¦ˆ
        function showFeedback(text, type) {
            feedbackDisplay.classList.remove('show', 'correct', 'wrong', 'combo');
            feedbackDisplay.textContent = text;
            feedbackDisplay.classList.add('show');
            if (type) {
                feedbackDisplay.classList.add(type);
            }
            setTimeout(() => {
                feedbackDisplay.classList.remove('show');
            }, 1000);
        }

        // å¯ç”¨/ç¦ç”¨åŠ¨ä½œæŒ‰é’®
        function enableActionButtons(enable) {
            actionButtons.forEach(button => {
                button.disabled = !enable;
            });
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            clearInterval(gameInterval);
            clearInterval(moveInterval);
            clearTimeout(moveTimeout);
            isGameRunning = false;
            enableActionButtons(false);
            masterMoveDisplay.classList.remove('show');
            expectedMoveId = null;
            gameBgMusic.pause();
            gameBgMusic.currentTime = 0;
            isGameBgMusicPlaying = false;
            bgMusicIcon.classList.remove('fa-volume-mute');
            bgMusicIcon.classList.add('fa-volume-up');
             // === ä¿®å¤ï¼šæ¸¸æˆç»“æŸæ—¶ä¿å­˜æ’­æ”¾æ¬¡æ•° ===
            const isUnlocked = localStorage.getItem(UNLOCK_KEY) === 'true';
            if (!isUnlocked) {
                let playCount = parseInt(localStorage.getItem(PLAY_COUNT_KEY)) || 0;
            // ç¡®ä¿æ’­æ”¾æ¬¡æ•°æ­£ç¡®å¢åŠ 
                if (playCount < 5) {
                    playCount++;
                    localStorage.setItem(PLAY_COUNT_KEY, playCount.toString());
                    console.log(`æ¸¸æˆç»“æŸï¼Œæ’­æ”¾æ¬¡æ•°æ›´æ–°ä¸º: ${playCount}`);
            
                // æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°æç¤º
                    if (playCount >= 3) {
                        showFeedback(`å‰©ä½™è¯•ç©æ¬¡æ•°: ${5 - playCount}`, 'combo');
                    }
                }
            }
                    gameOverlay.classList.remove('hidden');
                    gameOverlay.querySelector('h2').textContent = 'ç»ƒåŠŸç»“æŸï¼';
                    gameOverlay.querySelector('p').textContent = `ä½ çš„æœ€ç»ˆåˆ†æ•°æ˜¯ï¼š${score} åˆ†ï¼Œå¤§ç†Šè¾¾åˆ°äº† ${levelElement.textContent} å¢ƒç•Œï¼`;
                    gameOverlay.querySelector('button').textContent = 'å†æ¥ä¸€å±€';
                }
// æ˜¾ç¤ºéŸ³ä¹è¯´æ˜å‡½æ•°
function showMusicDescription(text, duration = 10000) {
    const popup = document.getElementById('musicDescription');
    const textElement = document.getElementById('descriptionText');
    
    if (popup && textElement) {
        textElement.textContent = text;
        popup.classList.add('show');
        
        // 10ç§’åè‡ªåŠ¨éšè—
        setTimeout(() => {
            popup.classList.remove('show');
        }, duration);
    }
}
        
        // ===== äº‹ä»¶ç›‘å¬å™¨ =====
        actionButtons.forEach(button => {
            button.addEventListener('click', handlePlayerAction);
        });

        bgMusicToggle.addEventListener('click', async () => {
            if (gameBgMusic.paused) {
                const success = await loadAndPlayMusic(gameBgMusic, bgMusicSelector.value, true);
                if (success) {
                    isGameBgMusicPlaying = true;
                    bgMusicIcon.classList.remove('fa-volume-mute');
                    bgMusicIcon.classList.add('fa-volume-up');
                    if (!relaxAudio.paused) {
                        relaxAudio.pause();
                    }
                }
            } else {
                gameBgMusic.pause();
                isGameBgMusicPlaying = false;
                bgMusicIcon.classList.remove('fa-volume-up');
                bgMusicIcon.classList.add('fa-volume-mute');
            }
        });

        bgMusicSelector.addEventListener('change', async (e) => {
            const newSrc = e.target.value;
            const wasPlaying = isGameBgMusicPlaying;
            gameBgMusic.pause();
            gameBgMusic.currentTime = 0;
            const success = await loadAndPlayMusic(gameBgMusic, newSrc, wasPlaying);
            if (success) {
                isGameBgMusicPlaying = true;
                bgMusicIcon.classList.remove('fa-volume-mute');
                bgMusicIcon.classList.add('fa-volume-up');
                if (!relaxAudio.paused) {
                    relaxAudio.pause();
                }
            } else {
                isGameBgMusicPlaying = false;
                bgMusicIcon.classList.remove('fa-volume-up');
                bgMusicIcon.classList.add('fa-volume-mute');
            }
        });

        relaxPlayButton.addEventListener('click', async () => {
            const success = await loadAndPlayMusic(relaxAudio, relaxMusicSelector.value, true);
            if (success) {
                if (!gameBgMusic.paused) {
                    gameBgMusic.pause();
                    isGameBgMusicPlaying = false;
                    bgMusicIcon.classList.remove('fa-volume-up');
                    bgMusicIcon.classList.add('fa-volume-mute');
                }
            }
        });

        relaxPauseButton.addEventListener('click', () => {
            relaxAudio.pause();
        });

// éŸ³é‡æ§åˆ¶
relaxVolumeSlider.addEventListener('input', function() {
    if(relaxAudio) {
        const volume = parseFloat(this.value);
        relaxAudio.volume = volume;
        console.log("æ”¾æ¾éŸ³ä¹éŸ³é‡è®¾ç½®ä¸º:", volume);
        
        // ä¿å­˜éŸ³é‡åå¥½
        localStorage.setItem('relax_music_volume', volume.toString());
    }
});

// é¡µé¢åŠ è½½æ—¶æ¢å¤éŸ³é‡è®¾ç½®
window.addEventListener('load', function() {
    const savedVolume = localStorage.getItem('relax_music_volume');
    if (savedVolume && relaxVolumeSlider && relaxAudio) {
        const volume = parseFloat(savedVolume);
        relaxVolumeSlider.value = volume;
        relaxAudio.volume = volume;
    }
});
       relaxMusicSelector.addEventListener('change', async (e) => {
    const newSrc = e.target.value;
    
    // === æ–°å¢ï¼šæ˜¾ç¤ºæ­Œæ›²è¯´æ˜ ===
    const selectedMusic = relaxMusicList.find(music => music.src === newSrc);
    if (selectedMusic && selectedMusic.description) {
        showMusicDescription(selectedMusic.description, 10000);
    }
    
    const wasRelaxPlaying = !relaxAudio.paused;
    relaxAudio.pause();
    relaxAudio.currentTime = 0;
    const success = await loadAndPlayMusic(relaxAudio, newSrc, wasRelaxPlaying);
    if (success) {
        if (!gameBgMusic.paused) {
            gameBgMusic.pause();
            isGameBgMusicPlaying = false;
            bgMusicIcon.classList.remove('fa-volume-up');
            bgMusicIcon.classList.add('fa-volume-mute');
        }
    }
});
       
// ===== é—¹é’ŸåŠŸèƒ½ =====

let alarmTimeout = null;
const alarmSound = new Audio();

// é—¹é’Ÿé“ƒå£°åˆ—è¡¨
const alarmSounds = {
    'default': 'sounds/default-alarm.mp3',
    'music1': 'music/æ™¨é—´å”¤èµ·_01_æŸ”å’Œé—¹é’Ÿ.mp3',
    'music2': 'music/æ™¨é—´å”¤èµ·_02_ç ´æ™“é¸Ÿé¸£.mp3'
};

// åˆ‡æ¢é—¹é’Ÿé¢æ¿
document.getElementById('alarmToggle').addEventListener('click', function() {
    const alarmPanel = document.getElementById('alarmPanel');
    const isHidden = alarmPanel.classList.contains('hidden');
    
    alarmPanel.classList.toggle('hidden');
    this.classList.toggle('active', !isHidden);
});

// ä¿å­˜é—¹é’Ÿ
document.getElementById('saveAlarm').addEventListener('click', function() {
    const alarmTime = document.getElementById('alarmTime').value;
    const alarmSoundType = document.getElementById('alarmSound').value;
    const alarmRepeat = document.getElementById('alarmRepeat').value;
    
    if (!alarmTime) {
        alert('è¯·è®¾ç½®é—¹é’Ÿæ—¶é—´');
        return;
    }
    
    setAlarm(alarmTime, alarmSoundType, alarmRepeat);
    
    // æ›´æ–°é—¹é’Ÿè§†è§‰çŠ¶æ€
    const alarmToggle = document.getElementById('alarmToggle');
    alarmToggle.classList.add('set');
    alarmToggle.title = `é—¹é’Ÿè®¾ç½®: ${alarmTime}`;
    
    alert(`é—¹é’Ÿå·²è®¾ç½®ä¸º ${alarmTime}`);
});

// è®¾ç½®é—¹é’Ÿå‡½æ•°
function setAlarm(time, soundType, repeatType) {
    if (alarmTimeout) {
        clearTimeout(alarmTimeout);
    }
    
    const now = new Date();
    const [hours, minutes] = time.split(':');
    const alarmDate = new Date();
    alarmDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
    
    if (alarmDate <= now) {
        alarmDate.setDate(alarmDate.getDate() + 1);
    }
    
    const timeUntilAlarm = alarmDate.getTime() - now.getTime();
    
    alarmTimeout = setTimeout(() => {
        playAlarmSound(soundType);
        
        if (repeatType !== 'once') {
            setAlarm(time, soundType, repeatType);
        }
    }, timeUntilAlarm);
    
    console.log(`é—¹é’Ÿè®¾ç½®: ${time}, è¿˜æœ‰ ${Math.round(timeUntilAlarm/1000/60)} åˆ†é’Ÿ`);
}

// æ’­æ”¾é—¹é’Ÿé“ƒå£° - æ™ºèƒ½è®¾å¤‡æ£€æµ‹ç‰ˆ
function playAlarmSound(soundType) {
    console.log('ğŸ”” é—¹é’Ÿæ—¶é—´åˆ°ï¼å£°éŸ³ç±»å‹:', soundType);
    
    // æ™ºèƒ½æ£€æµ‹ç§»åŠ¨è®¾å¤‡
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
        // ç§»åŠ¨ç«¯ï¼šä½¿ç”¨æŒ¯åŠ¨ + å…¨å±å¼¹çª—
        mobileAlarmAlert(soundType);
    } else {
        // ç”µè„‘ç«¯ï¼šä½¿ç”¨è‡ªåŠ¨æ’­æ”¾å£°éŸ³
        desktopAlarmAlert(soundType);
    }
}

// æ¡Œé¢ç«¯æé†’
function desktopAlarmAlert(soundType) {
    if (soundType !== 'default') {
        const audio = new Audio(soundType);
        audio.volume = 0.8;
        audio.loop = true;
        
        audio.play().then(() => {
            setTimeout(() => {
                if (confirm('â° é—¹é’Ÿå“äº†ï¼\nç‚¹å‡»ç¡®å®šå…³é—­é“ƒå£°')) {
                    audio.pause();
                }
            }, 1000);
        }).catch(e => {
            console.log('âŒ è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e.message);
            alert('â° èµ·åºŠæ—¶é—´åˆ°äº†ï¼è¯¥ç»ƒåŠŸäº†ï¼');
        });
    } else {
        alert('â° èµ·åºŠæ—¶é—´åˆ°äº†ï¼è¯¥ç»ƒåŠŸäº†ï¼');
    }
}

// ç§»åŠ¨ç«¯æé†’ - å¢å¼ºæŒ¯åŠ¨ç‰ˆ
function mobileAlarmAlert(soundType) {
    console.log('ğŸ“± ç§»åŠ¨ç«¯é—¹é’Ÿæé†’');
    
    // 1. å¼ºçƒˆæŒ¯åŠ¨æ¨¡å¼ï¼ˆæ›´åƒçœŸå®é—¹é’Ÿï¼‰
    if (navigator.vibrate) {
        // æ¨¡å¼ï¼šé•¿æŒ¯åŠ¨3ç§’ + çŸ­åœ0.5ç§’ + é‡å¤
        const vibratePattern = [3000, 500, 3000, 500, 3000, 500, 3000, 500];
        navigator.vibrate(vibratePattern);
        console.log('ğŸ“³ å¼€å§‹å¼ºçƒˆæŒ¯åŠ¨æé†’');
    }
    
    // 2. åˆ›å»ºæ— æ³•å¿½ç•¥çš„å…¨å±ç•Œé¢
    createMobileAlarmOverlay(soundType);
    
    // 3. å°è¯•åœ¨ç”¨æˆ·äº¤äº’åæ’­æ”¾å£°éŸ³
    setTimeout(() => {
        try {
            // åˆ›å»ºéŸ³é¢‘ä½†ä¸ç«‹å³æ’­æ”¾
            const audio = new Audio(soundType);
            audio.volume = 0.6;
            
            // å½“ç”¨æˆ·ç‚¹å‡»ç•Œé¢æ—¶å°è¯•æ’­æ”¾
            const tryPlayAudio = () => {
                audio.play().then(() => {
                    console.log('ğŸµ ç§»åŠ¨ç«¯å£°éŸ³æ’­æ”¾æˆåŠŸ');
                }).catch(e => {
                    console.log('ğŸ”‡ ç§»åŠ¨ç«¯å£°éŸ³æ’­æ”¾å¤±è´¥');
                });
            };
            
             // ç»‘å®šåˆ°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.addEventListener('click', tryPlayAudio, { once: true });
            
        } catch (e) {
            console.log('âŒ ç§»åŠ¨ç«¯éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥');
        }
    }, 1000);
}

// åˆ›å»ºç§»åŠ¨ç«¯å…¨å±é—¹é’Ÿç•Œé¢
function createMobileAlarmOverlay(soundType) {
    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å¼¹çª—
    const existingOverlay = document.getElementById('mobileAlarmOverlay');
    if (existingOverlay) {
        existingOverlay.remove();
    }
    
    // åˆ›å»ºå…¨å±é®ç½©
    const overlay = document.createElement('div');
    overlay.id = 'mobileAlarmOverlay';
    overlay.innerHTML = `
        <div class="mobile-alarm-container">
            <div class="alarm-icon">â°</div>
            <h2>èµ·åºŠæ—¶é—´åˆ°äº†ï¼</h2>
            <p>å¤§ç†Šæé†’æ‚¨è¯¥ç»ƒåŠŸäº†ï¼</p >
            <div class="alarm-buttons">
                <button id="snoozeAlarm">åˆ«è´ªç¡äº†</button>
                <button id="stopAlarm">å¿«èµ·åºŠ</button>
            </div>
        </div>
    `;
    // æ·»åŠ æ ·å¼
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff6b6b, #ffa726);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: Arial, sans-serif;
        color: white;
    `;
    
    const container = overlay.querySelector('.mobile-alarm-container');
    container.style.cssText = `
        text-align: center;
        background: rgba(255,255,255,0.95);
        padding: 30px;
        border-radius: 20px;
        color: #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        max-width: 90%;
        animation: pulse 0.8s infinite;
    `;
    
    const alarmIcon = overlay.querySelector('.alarm-icon');
    alarmIcon.style.cssText = `
        font-size: 4em;
        margin-bottom: 20px;
    `;
    
    const buttons = overlay.querySelector('.alarm-buttons');
    buttons.style.cssText = `
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: center;
    `;
    
    // æ·»åŠ æŒ‰é’®æ ·å¼
    const buttonStyle = `
        padding: 12px 20px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    `;
    
    const snoozeBtn = overlay.querySelector('#snoozeAlarm');
    snoozeBtn.style.cssText = buttonStyle + 'background: #4CAF50; color: white;';
    const stopBtn = overlay.querySelector('#stopAlarm');
    stopBtn.style.cssText = buttonStyle + 'background: #f44336; color: white;';

    // æ·»åŠ åŠ¨ç”»
    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes flash {
            0% { background: #ff6b6b; }
            50% { background: #ffa726; }
            100% { background: #ff6b6b; }
        }
        #mobileAlarmOverlay {
            animation: flash 1s infinite;
        }
    `;
    document.head.appendChild(style);
    
    // æ·»åŠ åˆ°é¡µé¢
    document.body.appendChild(overlay);
    
    // æŒ‰é’®äº‹ä»¶
    snoozeBtn.addEventListener('click', function() {
        console.log('â° åˆ«è´ªç¡äº†');
        overlay.remove();
        // åœæ­¢æŒ¯åŠ¨
        if (navigator.vibrate) {
            navigator.vibrate(0);
        }
        // 5åˆ†é’Ÿåå†æ¬¡æé†’
       setTimeout(() => {
            playAlarmSound(soundType);
        }, 5 * 60 * 1000);
    });
    stopBtn.addEventListener('click', function() {
        console.log('â¹ï¸ å¿«èµ·åºŠ');
        // åœæ­¢å£°éŸ³
        overlay.remove();        
        // åœæ­¢æŒ¯åŠ¨
        if (navigator.vibrate) {
            navigator.vibrate(0);
        }
        if (alarmAudio) {
            alarmAudio.pause();
            alarmAudio.currentTime = 0;
        }
    }); 
}
   // ä¿å­˜å’Œæ¢å¤é—¹é’Ÿè®¾ç½®
window.addEventListener('beforeunload', function() { 
        const alarmData = {
        time: document.getElementById('alarmTime').value,
        sound: document.getElementById('alarmSound').value,
        repeat: document.getElementById('alarmRepeat').value
    };
    localStorage.setItem('daxiong_alarm_settings', JSON.stringify(alarmData));
});


        // ===== åˆå§‹è®¾ç½® =====
document.addEventListener('DOMContentLoaded', () => {
        // ğŸ¯ è¯·æ±‚é€šçŸ¥æƒé™
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
            console.log('é€šçŸ¥æƒé™:', permission);
        });
    }
    const savedAlarm = localStorage.getItem('daxiong_alarm_settings');
        if (savedAlarm) {
        const alarmData = JSON.parse(savedAlarm);
        document.getElementById('alarmTime').value = alarmData.time;
        document.getElementById('alarmSound').value = alarmData.sound;
        document.getElementById('alarmRepeat').value = alarmData.repeat;
        
           if (alarmData.time) {
                setAlarm(alarmData.time, alarmData.sound, alarmData.repeat);
            
            // æ¢å¤è§†è§‰çŠ¶æ€
          const alarmToggle = document.getElementById('alarmToggle');
            alarmToggle.classList.add('set');
            alarmToggle.title = `é—¹é’Ÿè®¾ç½®: ${alarmData.time}`;
        }
    }
    
    // åŸæœ‰çš„åˆå§‹åŒ–ä»£ç 
    populateMusicSelectors();
    gameOverlay.classList.remove('hidden');
    startButton.addEventListener('click', startGame);
    
    // æ·»åŠ è´­ä¹°æŒ‰é’®äº‹ä»¶ç›‘å¬
    const purchaseButton = document.getElementById('purchaseButton');
    if (purchaseButton) {
        purchaseButton.addEventListener('click', initiatePurchase);
    }
    
    resetGame();
});
    </script>
 <!-- éŸ³ä¹è¯´æ˜å¼¹å‡ºæ¡† -->
    <div id="musicDescription" class="music-description-popup">
        <div class="description-content">
            <span id="descriptionText"></span>
        </div>
    </div>
<div class="footer-links">
    <a href="terms.html">æœåŠ¡æ¡æ¬¾</a>|  
    <a href="/privacy.html">éšç§æ”¿ç­–</a>| 
    <a href="/refund.html">é€€æ¬¾æ”¿ç­–</a>
</div>
    
</body>
</html>































































































































































































































































